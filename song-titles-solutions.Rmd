---
title: "US state mentioned in popular songs - SOLUTIONS"
output: github_document
---

Question: How often is each U.S. state mentioned in a popular song? 
Data: Billboard Year-End Hot 100 (1958-present) and the Census Bureau ACS

Load libraries 
```{r}
library(tidyverse)
library(tidytext)
library(here)
```


Simply run the following code to import the two dataframes (song lyrics and population data). Before completing the next task, spend some time looking at these two data frames. 
If you are not working on Workbench, change the path to import the files!

```{r}
song_lyrics <- here("data", "billboard_lyrics_1964-2015.csv") %>%
  read_csv()
glimpse(song_lyrics)
```

```{r}
pop_df <- here("data", "pop2016.csv") %>%
  read_csv()
glimpse(pop_df)
```


Complete the following tasks (add as many R code chunks as you like)

Using the `song_lyrics` data as input ,create a novel data frame with one row for each token in each song (remember the `unnest_tokens` function!) To search for matching state names, the df you create should include both unigrams and bigrams (e.g., your tokenizer should create both)

```{r}
# tokenize unigrams
lyrics_unigrams <- unnest_tokens(
  tbl = song_lyrics,
  output = word,
  input = Lyrics)

# tokenize bigrams
lyrics_bigrams <- unnest_tokens(
  tbl = song_lyrics,
  output = word,
  input = Lyrics, 
  token = "ngrams", n = 2)

# Combine together
tidy_lyrics <- bind_rows(lyrics_unigrams, lyrics_bigrams)
tidy_lyrics

```


Find all the state names occurring in the song lyrics. To complete this task, first create a data frame that meets this criteria using `inner_join()`. Then, save a new data frame that only includes one observation for each matching song (that is, if the song is "New York, New York", there should only be one row in the resulting table for that song -- you can use the `distinct()` function to accomplish this task)

`inner_join()` to combine and only keep words that are state names
`distinct()` to deduplicate states per song (count each state once per song it is mentioned in)

```{r}
tidy_lyrics <- inner_join(tidy_lyrics, pop_df, by = c("word" = "state_name")) %>%
  distinct(Rank, Song, Artist, Year, word, .keep_all = TRUE)
tidy_lyrics
```


Calculate the frequency for each state's mention in a song and create a new column for the frequency adjusted by the state's population

```{r}
# aggregate per state
(state_counts <- tidy_lyrics %>% 
    count(word) %>% 
    arrange(desc(n)))

# normalize for population
pop_df <- pop_df %>% 
  left_join(state_counts, by = c("state_name" = "word")) %>% 
  mutate(rate = n / population * 1e6)

# top ten states by rate
pop_df %>%
  arrange(desc(rate)) %>%
  top_n(10)
```
